
<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
<!--script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script-->
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>

<script type="text/javascript" src="/assets/js/yes_no_ctrls.js"></script>
<link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css">
<script type="text/javascript" src="/assets/js/post_parameters.js"></script>
<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
<script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>
<link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">

<style>

    .inputFrameClass {
        width: 96% !important;
    }

    #clearButton {
        display: none;
    }

</style>

<script>
    var tstCurrentDate = moment(tstCurrentDate).format("YYYY-MM-DD");
</script>

<body id="mateme">
<div id="container">
    <div id="content">

        <form>
            <select id="hiv_status_value" name="pmtct_activities" helpText="PMTCT Status" tt_onUnLoad="changeNextButton();">
                <option>Non-Reactive</option>
                <option>Reactive</option>
                <option>Unknown</option>
            </select>

            <input type="text" name="pmtct" id="pmtct" helpText="PMTCT test date" field_type="date"
                   tt_pageStyleClass="date"  condition ="$('hiv_status_value').value.toLowerCase() != 'unknown'" tt_onUnLoad="changeNextButton();" />

            <select id="on_arvs" name="pmtct_activities" helpText="On ARVs"
                    condition = "$('hiv_status_value').value.trim().toUpperCase() == 'REACTIVE';">
                <option>Yes</option>
                <option>No</option>
            </select>

            <input type="text" name="pmtct" id="period_on_arvs" helpText="Date Started ARVs (Estimate)"
                   field_type="date" tt_pageStyleClass="date"
                   condition ="$('on_arvs').value.trim().toUpperCase() == 'YES';" />

            <select id="feeding_option" name="pmtct_activities" helpText="Feeding Option" condition = "$('hiv_status_value').value.trim().toUpperCase() == 'REACTIVE';" tt_onLoad="changeNextButton();">
                <option>Exclusive Breast Feeding</option>
                <option>No Breast Feeding</option>
                <option>Exclusive Formula Feeding</option>
            </select>

        </form>

    </div>
</div>
</body>
<script>
    function changeNextButton() {
        var hivStatus = document.getElementById('hiv_status_value').value;
        var pmtct = document.getElementById('pmtct').value;

        if (hivStatus === 'Unknown') {
            postSocialHistory();
        } else if(hivStatus === 'Non-Reactive' && pmtct !== '') {
            postSocialHistory();
        } else {
            var nextButton =  document.getElementById('nextButton');
            nextButton.setAttribute("onmousedown","postSocialHistory();")
        }

    }

    function postSocialHistory() {
        var currentTime = moment().format(' HH:mm:ss');
        var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
        encounter_datetime += currentTime;

        var encounter = {
            encounter_type_name: 'PMTCT HISTORY',
            encounter_type_id:  129,
            patient_id: sessionStorage.patientID,
            encounter_datetime: encounter_datetime
        };

        submitParameters(encounter, "/encounters", "nextPage");
    }

    function nextPage(){
        console.log('hey');
        nextEncounter(sessionStorage.patientID, sessionStorage.programID);
    }
</script>
